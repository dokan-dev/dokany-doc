<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Dokan: Dokan Doxygen</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Dokan 1.0.2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Dokan Doxygen </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the homepage of the Doxygen generated documentation for Dokany.</p>
<p>We recommend you take a look at <a href="https://github.com/dokan-dev/dokany/wiki">our wiki</a> for an introduction of how to use the library. You may find mirror samples using Dokan API or Fuse API <a href="https://github.com/dokan-dev/dokany/tree/master/samples">here</a> useful.</p>
<h2>How to create your file systems</h2>
<h3>Dokan operations</h3>
<p>To create a file system, an application needs to implement functions in <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> structure (declared in <a class="el" href="dokan_8h.html">dokan.h</a>). Once implemented, you can invoke <a class="el" href="group___dokan.html#ga099fb73df80893f9da337a2dd7a6634e">DokanMain</a> function with <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> as parameter in order to mount the file system. The semantics of functions in <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> are similar to corresponding Windows APIs with the same name. The parameters for these functions are therefore the same as for their counterpart Windows APIs. These functions are called from many threads so they need to be thread-safe, otherwise many problems may occur.</p>
<p>These functions are typically invoked in this sequence:</p>
<ol type="1">
<li><a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a40c2f61e1287237f5fd5c2690e795183">DOKAN_OPERATIONS::ZwCreateFile</a></li>
<li>Other functions (like <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a92457133b49740e54142183f90efd723" title="ReadFile Dokan API callback. ">DOKAN_OPERATIONS.ReadFile</a> or <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#ab1aa9dab25dcb38903e0790c36b87cce" title="WriteFile Dokan API callback. ">DOKAN_OPERATIONS.WriteFile</a>)</li>
<li><a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a2780a352d1d83104843971bc551aa643">DOKAN_OPERATIONS::Cleanup</a></li>
<li><a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a8cec45a9afcc0fc737fb765eb97c639d">DOKAN_OPERATIONS::CloseFile</a></li>
</ol>
<p>Before file access operations (listing directory entries, reading file attributes, ...), <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a40c2f61e1287237f5fd5c2690e795183" title="CreateFile Dokan API callback. ">DOKAN_OPERATIONS.ZwCreateFile</a> is always invoked. On other hand, the function <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a2780a352d1d83104843971bc551aa643" title="Cleanup Dokan API callback. ">DOKAN_OPERATIONS.Cleanup</a> always gets called by the Dokan file system driver when the file is closed by the <code>CloseHandle</code> Windows API.</p>
<p>Each function should return <code>STATUS_SUCCESS</code> when the operation succeeds, otherwise if an error occurs, return the proper <code>NTSTATUS</code> (<a href="https://support.microsoft.com/en-us/kb/113996">https://support.microsoft.com/en-us/kb/113996</a>). For example, when ZwCreateFile can't open a file (Win32 error <code>ERROR_FILE_NOT_FOUND</code>), you should return <code>STATUS_OBJECT_NAME_NOT_FOUND</code>. Dokan has an exported helper that can be used to convert Win32 Error to <code>NTSTATUS</code> with <a class="el" href="group___dokan.html#ga1bcba8145ee5205cd41fa5eebdffaa82">DokanNtStatusFromWin32</a>.</p>
<p>There is a case with <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a40c2f61e1287237f5fd5c2690e795183" title="CreateFile Dokan API callback. ">DOKAN_OPERATIONS.ZwCreateFile</a> that should return <code>STATUS_OBJECT_NAME_COLLISION</code> instead of <code>STATUS_SUCCESS</code> when the param CreationDisposition is <code>CREATE_ALWAYS</code> or <code>OPEN_ALWAYS</code> and the file requested successfully opened already existed.</p>
<p>Note: when applications make use of memory mapped files, WriteFile or ReadFile functions may be invoked after Cleanup in order to complete the I/O operations. The file system application should also properly work in this case.</p>
<h3>Dokan File Info Life time</h3>
<p>The last parameter of each <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> functions is a <a class="el" href="struct_d_o_k_a_n___f_i_l_e___i_n_f_o.html" title="Dokan file information on the current operation. ">DOKAN_FILE_INFO</a> struct. Each file handle from user mode is associated with a <a class="el" href="struct_d_o_k_a_n___f_i_l_e___i_n_f_o.html" title="Dokan file information on the current operation. ">DOKAN_FILE_INFO</a> struct. Hence, the content of the struct does not change if the same file handle is used. The struct is created when the file is opened by <code>CreateFile</code> system call and destroyed when the file is closed by <code>CloseHandle</code> system call. It store all file information on the current operation.</p>
<p><a class="el" href="struct_d_o_k_a_n___f_i_l_e___i_n_f_o.html#a318f415c3fe401e3949fa31ff1d4cecd">DOKAN_FILE_INFO.Context</a> is an arbitrary value assigned by the file system application. File system application can freely use this variable to store values that are constant in a file access session (the period from <code>CreateFile</code> to <code>CloseFile</code>) such as file handle, etc.</p>
<p>When the <a class="el" href="struct_d_o_k_a_n___f_i_l_e___i_n_f_o.html#a59e9f25b2df70b7b94c2e1ffcd3df840">DOKAN_FILE_INFO.IsDirectory</a> is set to <code>TRUE</code>, the file under the operation is a directory. When it is <code>FALSE</code>, the file system application programmers are required to set the variable to <code>TRUE</code> if the current operation acts on a directory. If the value is <code>FALSE</code> and the current operation is not acting on a directory, the programmers should not change the variable. Note that setting the variable to <code>TRUE</code> when a directory is accessed is very important for the Dokan library. If it is not set correctly, the library does not know the operation is acting on a directory and many problems may occur.</p>
<p><a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a2780a352d1d83104843971bc551aa643" title="Cleanup Dokan API callback. ">DOKAN_OPERATIONS.Cleanup</a> is invoked when the function CloseHandle in Windows API is executed. If the file system application stored a file handle in the Context variable when the function <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a40c2f61e1287237f5fd5c2690e795183" title="CreateFile Dokan API callback. ">DOKAN_OPERATIONS.ZwCreateFile</a> is invoked, this should be closed in the <code>Cleanup</code> function, not in <code>CloseFile</code> function. If the user application calls CloseHandle and subsequently opens the same file, the <code>CloseFile</code> function of the file system application may not be invoked before the <code>CreateFile</code> API is called and therefore may cause a sharing violation error since the <code>HANDLE</code> has not been closed.</p>
<h3>Find Files</h3>
<p><a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a85eaf4afc25a6d645b72ae59df78a27e" title="FindFiles Dokan API callback. ">DOKAN_OPERATIONS.FindFiles</a> or <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a0f280feb3cbff134e997bec6d6db5171" title="FindFilesWithPattern Dokan API callback. ">DOKAN_OPERATIONS.FindFilesWithPattern</a> are called in order to respond to directory listing requests.You should implement either one of the two functions.</p>
<p>For each directory entry, file system applications should call the function FillFindData (passed as a function pointer to FindFiles, FindFilesWithPattern) with the <code>WIN32_FIND_DATAW</code> structure filled with directory information: <code>FillFindData( &amp;win32FindDataw, DokanFileInfo )</code>. It is the responsibility of file systems to process wildcard patterns because shells in Windows are not designed to work properly with pattern matching. When file system application only implement FindFiles, the wildcard patterns are automatically processed by the Dokan library. You can control wildcard matching by implementing <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html#a0f280feb3cbff134e997bec6d6db5171" title="FindFilesWithPattern Dokan API callback. ">DOKAN_OPERATIONS.FindFilesWithPattern</a> function. The function <a class="el" href="group___dokan.html#ga2e8585b8730ee74c0cd0cadf3e8cb01a">DokanIsNameInExpression</a> exported can be used to process wildcard matching.</p>
<h3>Mounting</h3>
<p>As stated above, the file system can be mounted by invoking <a class="el" href="group___dokan.html#ga099fb73df80893f9da337a2dd7a6634e">DokanMain</a> function. The function blocks until the file system is unmounted. File system applications should fill <a class="el" href="struct_d_o_k_a_n___o_p_t_i_o_n_s.html" title="Dokan mount options used to describe dokan device behavior. ">DOKAN_OPTIONS</a> struct to describe the futur device and <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> with function pointers for file system operations (such as ZwCreateFile, ReadFile, CloseFile, ...) before passing these parameters to DokanMain function. Functions in <a class="el" href="struct_d_o_k_a_n___o_p_e_r_a_t_i_o_n_s.html" title="Dokan API callbacks interface. ">DOKAN_OPERATIONS</a> struct need to be thread-safe, because they are called in several threads (not the thread invoking DokanMain) with different execution contexts. <a class="el" href="group___dokan.html#ga099fb73df80893f9da337a2dd7a6634e">DokanMain</a> can instantly return a <a class="el" href="group___dokan_main_result.html">DokanMainResult</a> status in case of mount failure.</p>
<p><a class="el" href="struct_d_o_k_a_n___o_p_t_i_o_n_s.html#a2ed6d3cbd74669deedd1fdd698e81585">DOKAN_OPTIONS.Options</a> with <a class="el" href="group___d_o_k_a_n___o_p_t_i_o_n.html">DOKAN_OPTION</a> flags describe the behavior of the device.</p>
<h3>Unmounting</h3>
<p>File system can be unmounted by calling the function <a class="el" href="group___dokan.html#gae9ed3293f6830c8ace6419082434128a">DokanUnmount</a> or <a class="el" href="group___dokan.html#ga5b47eeb4d113e9981b11e4c22890027f">DokanRemoveMountPoint</a>. In most cases when the programs or shells using the file system hang, unmount operation will solve the problem by bringing the system to a previous state when the file system was not mounted.</p>
<p>User may use command line to unmount file system like this: </p><blockquote class="doxtable">
<p>dokanctl.exe /u DriveLetter </p>
</blockquote>
<h2>Network Provider</h2>
<p>If mounting is done with <a class="el" href="group___d_o_k_a_n___o_p_t_i_o_n.html#ga6db515a2ec6fd8e19ac98be3aab75a31">DOKAN_OPTION_NETWORK</a>, you need Dokan Network Provider for it to work correctly. This file (dokannp1.dll) <em>must</em> be copied to <code>WINDIR%\system32</code> and you can register the provider on your system with <code>dokanctl.exe /i n</code> command.</p>
<p>Without this <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa378776%28v=vs.85%29.aspx">Network Provider</a>, Windows Explorer will not handle well Virtual drives mounted as network share and your drive could appears disconnected.</p>
<p>If Network Redirector is setup by setting up an UNC Name, Dokan Network Provider will assign UNC Name to the drive label automatically.</p>
<h2>Testing your FileSystem</h2>
<p>You can test you filesystem by using different tools. Microsoft has his own tools like <a href="https://msdn.microsoft.com/en-us/library/windows/hardware/hh998457%28v=vs.85%29.aspx">Runkarr</a>, <a href="https://msdn.microsoft.com/en-us/library/gg607473%28v=vs.85%29.aspx">IFSTest</a> or <a href="https://msdn.microsoft.com/windows/hardware/drivers/develop/how-to-select-and-configure-the-device-fundamental-tests">Device Fundamentals</a>.</p>
<p>There is also <a href="https://github.com/Liryna/winfstest">WinFSTest</a>, Dokany is automatically running it on the sample mirror at every commit with appveyor.</p>
<p>For C# developers, there is <a href="https://github.com/dokan-dev/dokan-dotnet/tree/master/DokanNet.Tests">DokanNet.Tests</a> made by viciousviper that currently only test C# Mirror sample but can easily be changed to test a C# Dokan FS.</p>
<h2>Misc</h2>
<p>If there are bugs in Dokan library or file system applications which use the library, you will get the Windows blue screen. Therefore, it is strongly recommended to use Virtual Machine when you develop file system applications. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
